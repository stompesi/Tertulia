<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>New Web Project</title>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<style>
			img {
				height: 50px;
				width: 50px;
			}
		</style>
	</head>
	<body>
		<select id="selectMapSize">
			<option value="16">4 x 4</option>
			<option value="36">6 x 6</option>
			<option value="64">8 x 8</option>
			<option value="100">10 x 10</option>
		</select>
		<br />
		<input type="button" id="start" value="Game Start" />
		<input type="button" id="rank" value="순위" />
		<table id= "gameMap" border="1"></table>
	</body>
</html>
<script type="text/javascript">
	//alert($('input#selectMapSize').val());
	//tr의 아이디를 정함
	var mapSize;
	$('#start').click(function() {

		//게임맵을 그림
		drawMap();

		var check = {
			id : '',
			sequence : ''
		};

		//카드를 만듬
		var cards = [];
		makeCards(cards);

		//카드전체 보여주기
		showAllCards(cards);

		//카드 아이디 보여주기 (삭제예정)
		for(var i = 1; i <= mapSize; i++) {
			console.log(cards[i].id);
		}
		
		$('img').click(function() {
		var sequence = this.id;
		var fadeInSpeed = 300;
		var fadeOutSpeed = 200;
		var delaySpeed = 500;
		if(cards[sequence].isEvert) {
			cards[sequence].isEvert = false;
			showCard(sequence, +cards[sequence].id + ".jpg", fadeOutSpeed, fadeInSpeed);
			if(check.id == "") {
				check.id = cards[sequence].id;
				check.sequence = cards[sequence].sequence;
			} else {
				$('#' + check.sequence).delay(delaySpeed);
				if(check.id == cards[sequence].id) {
					check.id = "";
					checkFinishGame(cards);
				} else {
					showCard(cards[sequence].sequence, "background.jpg", fadeOutSpeed, fadeInSpeed);
					showCard(check.sequence, "background.jpg", fadeOutSpeed, fadeInSpeed);
					cards[sequence].isEvert = true;
					cards[check.sequence].isEvert = true;
					check.id = "";
				}
			}
		}
	});

	});
	function drawMap() {
		$('#gameMap').children().remove();
		mapSize = $('#selectMapSize').val();
		for(var i = 1; i <= mapSize; i++) {
			if(i % Math.pow(mapSize, 0.5) == 1) {
				var trId = $('<tr/>');
				$('#gameMap').append(trId);
			}
			$(trId).append('<td><img id=' + i + ' src="background.jpg"/></td>');
		}
	}

	function makeCards(cards) {
		for(var i = 1; i <= mapSize; i++) {
			cards[i] = {
				sequence : i,
				id : '',
				isEvert : true
			};
		}
		for(var i = 1; i <= mapSize; i++) {
			var ransequence = randSequence();
			if(cards[ransequence].id == "") {
				cards[ransequence].id = i % (Math.pow(mapSize, 0.5) * 2) + 1;
			} else {
				i--;
			}
		}
	}

	function showCard(id, atrributeValue, fadeOutSpeed, fadeInSpeed) {
		$('#' + id).fadeOut(fadeOutSpeed, function() {
			$('#' + id).attr('src', atrributeValue);
		});
		$('#' + id).fadeIn(fadeInSpeed);
	}

	function randSequence() {
		return Math.ceil(Math.random() * mapSize);
	}

	function checkFinishGame(cards) {
		for(var i = 1; i <= mapSize; i++) {
			if(cards[i].isEvert == false) {
				if(i == mapSize)
					alert('게임을 완료하였습니다.');
			} else {
				break;
			}
		}
	}

	function showAllCards(cards) {
		var fadeInSpeed = 1000;
		var fadeOutSpeed = 500;
		for(var i = 1; i <= mapSize; i++) {
			showCard(i, cards[i].id + ".jpg", fadeOutSpeed, fadeInSpeed);
			showCard(i, "background.jpg", fadeOutSpeed, fadeInSpeed);
		}
	}
</script>
